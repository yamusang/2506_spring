<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>커뮤니티 게시판 연습</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<style type="text/css">
		.container {
			width: 750px;
		}

		i {
			cursor: pointer;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>Hello, world!</h1>
		<hr>
		<div class="mt-3">
			<div>
				<div class="card">
					<div class="card-header">
						Welcome! Community - 글 읽기
					</div>
					<div class="card-body">
						<div class="input-group mb-3">
							<span class="input-group-text col-2">작성자</span>
							<label class="col-4">
								<input name="writer" class="form-control" th:value="${dto.writer}" disabled>
							</label>
							<span class="input-group-text col-2">조회수</span>
							<label class="col-2">
								<input name="writer" class="form-control" th:value="${dto.readCount}" disabled>
							</label>
						</div>
						<div class="input-group">
							<span class="input-group-text col-2">제목</span>
							<label class="col-10">
								<input name="title" class="form-control" th:value="${dto.title}" placeholder="제목을 입력하세요.">
							</label>
						</div>
						<div class="input-group">
							<span class="input-group-text col-2">작성날짜</span>
							<label class="col-10">
								<input name="title" class="form-control" th:value="${#dates.format(dto.createdAt,'yyyy-MM-dd HH:mm')}"
									placeholder="제목을 입력하세요.">
							</label>
						</div>
						<div class="input-group">
							<span class="input-group-text col-2">내용</span>
							<label class="col-10">
								<textarea name="content" class="form-control" rows="15" style="resize: none;"
									disabled>[[${dto.content}]]</textarea>
							</label>
						</div>
						<div class="my-4">
							<div class="float-end">
								<a th:href="|@{list?page=}${page}|">
									<button type="button" class="btn btn-info">목록</button>
								</a>
								<th:block th:if="${dto.writer == session.username}">
									<a th:href="|@{modify?page=}${page}&idx=${dto.idx}|">
										<button type="button" class="btn btn-info">수정</button>
									</a>
									<!-- button 스타일 때문에 form 밖으로 옮김-->
									<button type="button" class="btn btn-info" onclick="check()">삭제</button>
									<form action="remove" method="get">
										<input type="hidden" name="idx" th:value="${dto.idx}">
										<input type="hidden" name="page" th:value="${page}">
									</form>
								</th:block>
								<script type="text/javascript">
									function check() {
										if (confirm('글을 삭제하시겠습니까?')) {
											document.forms[0].submit()
										}
									}
								</script>
							</div>
						</div>
					</div>
				</div>
				<hr />
				<h4>댓글
					<span class="badge" style="background-color: #bebebf;color:#6f42c1;font-size:0.7rem;">
						[[${dto.commentCount}]]</span>
				</h4>
				<div class="row mt-3">
					<!-- 댓글 쓰기 -->
					 <div class="row">
						<input type="hidden" id="writer" th:value="${session.username}">
						<input type="hidden" id="mref" th:value="${dto.idx}">
						<div class="input-group mb-3">
							<!-- input : single line , textarea : multi line -->
							 <textarea class="form-control" rows="5" id="content"></textarea>
							 <!-- 로그인 상태 ⭕ : 저장 버튼 -->
							 <th:block th:if="${session.username !=null}">
								<button type="button" class="btn btn-outline-secondary" id="btnSave">저장</button>
							 </th:block>
							 <!-- 로그인 상태 ❌ : 로그인 버튼 -->
							 <th:block th:unless="${session.username !=null}">
								<button type="button" class="btn btn-outline-secondary" id="btnLogin">로그인</button>
							 </th:block>
						</div>
					 </div>
					<hr />
					<!-- 이 글의 idx 로 조회한 댓글 목록이 출력됩니다.-->
					<ul class="list-group myfs-9" id="replyList">
						<li class="list-group-item d-flex">
							<span class="col-5 myfc-1">${dto.writer}</span>
							<span class="col-6">${dto.createdAt}</span>
							<span class="col-1">
								<!-- 삭제 아이콘 -->
								<i class="bi bi-trash" data-num="${dto.idx}"></i>
							</span>
						</li>
						<li class="list-group-item d-flex">
							<textarea class="form-control myfs-9" disabled>${dto.content}</textarea>
						</li>
					</ul>
					<!-- 여기 까지 댓글 목록 -->
				</div>
			</div>
		</div>
	</div>
	<script>
		//comments.js 는 프론트엔드 정적 리소스이므로 백엔드 세션값을 직접 가져갈 수 없습니다.
		//백엔드 타임리프 html의 script 태그는 가능합니다. comment.js가 사용할 수 있게 변수 값 할당.
		const username = '[[${session.username}]]'
		const mref = '[[${dto.idx}]]'  // 모든 댓글의 mref
	</script>
	<script src="/js/comments.js"></script>
</body>

</html>